// --- ELEMENTLER ---
const latin = document.getElementById('latin');
const greek = document.getElementById('greek');
const dropdownBtn = document.getElementById('dropdownBtn');
const dropdownMenu = document.getElementById('dropdownMenu');
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const htmlElement = document.documentElement;

let activeInput = latin;

// --- ÇEVİRİ MANTIĞI ---
const toGreek = {
    "a":"Α","A":"Α","e":"Ε","E":"Ε","i":"Ͱ","İ":"Ͱ","n":"Ν","N":"Ν","r":"Ρ","R":"Ρ","l":"L","L":"L","ı":"Ь","I":"Ь","k":"Κ","K":"Κ","d":"D","D":"D","m":"Μ","M":"Μ","t":"Τ","T":"Τ","y":"R","Y":"R","s":"S","S":"S","u":"U","U":"U","o":"Q","O":"Q","b":"Β","B":"Β","ş":"Ш","Ş":"Ш","ü":"Υ","Ü":"Υ","z":"Ζ","Z":"Ζ","g":"G","G":"G","ç":"C","Ç":"C","ğ":"Γ","Ğ":"Γ","v":"V","V":"V","c":"J","h":"Η","H":"Η","p":"Π","P":"Π","ö":"Ω","Ö":"Ω","f":"F","F":"F","x":"Ψ","X":"Ψ","j":"Σ","J":"Σ","0":"θ"
};
const toLatin = Object.fromEntries(Object.entries(toGreek).map(([k,v])=>[v,k.toUpperCase()]));

function translateText(text, dir){
    const map = dir === "toGreek" ? toGreek : toLatin;
    return text.split('').map(ch => map[ch] || ch).join('');
}

// --- EVENT LISTENERS (Çeviri) ---
latin.addEventListener('input', () => { greek.value = translateText(latin.value, "toGreek"); });
greek.addEventListener('input', () => { latin.value = translateText(greek.value, "toLatin"); });
latin.addEventListener('focus', () => activeInput = latin);
greek.addEventListener('focus', () => activeInput = greek);

// --- TEMA YÖNETİMİ ---
themeToggle.addEventListener('click', () => {
    htmlElement.classList.toggle('dark');
    const isDark = htmlElement.classList.contains('dark');
    themeIcon.innerText = isDark ? 'light_mode' : 'dark_mode';
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
});

// Kayıtlı temayı yükle
if (localStorage.getItem('theme') === 'light') {
    htmlElement.classList.remove('dark');
    themeIcon.innerText = 'dark_mode';
}

// --- DROPDOWN YÖNETİMİ ---
dropdownBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    dropdownMenu.classList.toggle('hidden');
    dropdownMenu.classList.toggle('show');
});

document.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', () => {
        document.getElementById('selectedText').innerText = item.dataset.value;
        document.getElementById('selectedIcon').innerText = item.dataset.icon;
        dropdownMenu.classList.add('hidden');
        dropdownMenu.classList.remove('show');
    });
});

window.addEventListener('click', () => {
    dropdownMenu.classList.add('hidden');
    dropdownMenu.classList.remove('show');
});

// --- KLAVYE TUŞLARI ---
document.querySelectorAll('.key').forEach(key => {
    key.addEventListener('click', () => {
        const action = key.dataset.action;
        let content = key.innerText.trim();
        
        if (action === 'delete') { activeInput.value = activeInput.value.slice(0, -1); }
        else if (action === 'reset') { latin.value = ""; greek.value = ""; }
        else if (action === 'space') { activeInput.value += ' '; }
        else if (action === 'enter') { activeInput.value += '\n'; }
        else if (!action) { activeInput.value += content; }

        if (activeInput === latin) { greek.value = translateText(latin.value, "toGreek"); }
        else { latin.value = translateText(greek.value, "toLatin"); }
    });
});
